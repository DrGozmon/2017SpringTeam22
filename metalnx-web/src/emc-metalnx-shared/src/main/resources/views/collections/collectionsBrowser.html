<!--
  ~    Copyright (c) 2015-2016, EMC Corporation
  ~
  ~ 	Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  ~
  -->

<!-- Invalid path provided -->
<div class="col-xs-12" id="invalidPathErrorMsg">
	<div class="alert alert-danger" role="alert"
		th:if="${invalidPath != null}">
		<p class="text-center">
			<b th:text="${invalidPath}"></b> does not exist or user lacks access permission.
		</p>
	</div>
</div>

<!-- Invalid number of steps in history stack -->
<div class="col-xs-12">
	<div class="alert alert-danger" role="alert"
		th:if="${invalidStepsBackwards != null}">
		<p class="text-center">
			It is not possible to go "<b th:text="${invalidStepsBackwards}"></b>" steps backwards in history stack.
		</p>
	</div>
</div>
<div class="col-xs-12">
	<div class="alert alert-danger" role="alert"
		th:if="${invalidStepsForward != null}">
		<p class="text-center">
			It is not possible to go "<b th:text="${invalidStepsForward}"></b>" steps forward in history stack.
		</p>
	</div>
</div>

<!-- Path permission denied -->
<div class="col-xs-12">
	<div class="alert alert-danger" role="alert"
		th:if="${pathPermissionDenied != null}">
		<p class="text-center">
			This user doesn't have access for the provided path: "<b th:text="${pathPermissionDenied}"></b>".
		</p>
	</div>
</div>

<!-- Current Collections Table -->
<div class="col-xs-12">
	<div class="alert alert-danger" role="alert"
		th:if="${noResultsFoundForSearchText}">
		<p class="text-center">
			<span th:text="#{search.results.not.found.label}"></span> "<b><span
				th:text="${searchText}"></span></b>".
		</p>
	</div>
</div>

<!-- Download fail -->
<div class="col-sm-12 hideElement" id="downloadFailureMessage">
	<div class="alert alert-danger alert-dismissible text-center" role="alert">
	  	<button type="button" class="close" data-dismiss="alert">
	  		<span aria-hidden="true">&times;</span>
	  		<span class="sr-only">Close</span>
	  	</button>
	  	<span>
			Download failed. Please, check if you have permissions to perform such operation.
	  	</span>
	</div>
</div>

<!-- Upload fail message -->
<div class="col-sm-12" id="uploadFailMessage">
	<div th:if="${allFilesUploaded == false}"
		class="alert alert-danger alert-dismissible text-center" role="alert">
		<button type="button" class="close" data-dismiss="alert">
			<span aria-hidden="true">&times;</span> <span class="sr-only">Close</span>
		</button>
		<span> Upload failed. Please, check if you have permissions to
			perform such operation. </span>
	</div>
</div>

<!-- Upload success message -->
<div class="col-sm-12" id="uploadSuccessMessage">
	<div th:if="${allFilesUploaded == true}"
		class="alert alert-success alert-dismissible text-center" role="alert">
		<button type="button" class="close" data-dismiss="alert">
			<span aria-hidden="true">&times;</span> <span class="sr-only">Close</span>
		</button>
		<span th:if="${fileUploaded != null}"
			th:text="|The file ${fileUploaded} was successfully uploaded.|"></span>
		<span th:unless="${fileUploaded != null}">The selected files
			were successfully uploaded.</span>
	</div>
</div>

<!-- All items moved -->
<div class="col-sm-12">
	<div th:if="${failedMoves != null and #lists.isEmpty(failedMoves)}"
		class="alert alert-success alert-dismissible text-center" role="alert">
		<button type="button" class="close" data-dismiss="alert">
			<span aria-hidden="true">&times;</span> <span class="sr-only">Close</span>
		</button>
		<span th:if="${fileMoved !=null}"
			th:text="|The file ${fileMoved} was moved to ${currentPath}.|"></span>
		<span th:unless="${fileMoved !=null}"
			th:text="|The selected files were moved to ${currentPath}.|"></span>
	</div>
</div>

<!-- Some items were not moved -->
<div class="col-sm-12">
	<div th:if="${not #lists.isEmpty(failedMoves)}"
		class="alert alert-danger alert-dismissible text-center" role="alert">
		<button type="button" class="close" data-dismiss="alert">
			<span aria-hidden="true">&times;</span> <span class="sr-only">Close</span>
		</button>
		<span>The following items failed to be moved: </span> <b
			th:text="${#strings.replace(#strings.replace(#strings.toString(failedMoves), '[', ''), ']', '')}"></b>
	</div>
</div>

<!-- All items copied -->
<div class="col-sm-12">
	<div th:if="${failedCopies != null and #lists.isEmpty(failedCopies)}"
		class="alert alert-success alert-dismissible text-center" role="alert">
		<button type="button" class="close" data-dismiss="alert">
			<span aria-hidden="true">&times;</span> <span class="sr-only">Close</span>
		</button>
		<span th:if="${fileCopied != null}"
			th:text="|The file ${fileCopied} was copied to ${currentPath}.|"></span>
		<span th:unless="${fileCopied != null}"
			th:text="|The selected files were copied to ${currentPath}.|"></span>
	</div>
</div>

<!-- Some items were not copied -->
<div class="col-sm-12">
	<div th:if="${not #lists.isEmpty(failedCopies)}"
		class="alert alert-danger alert-dismissible text-center" role="alert">
		<button type="button" class="close" data-dismiss="alert">
			<span aria-hidden="true">&times;</span> <span class="sr-only">Close</span>
		</button>
		<span>The following items failed to be copied: </span> <b
			th:text="${#strings.replace(#strings.replace(#strings.toString(failedCopies), '[', ''), ']', '')}"></b>
	</div>
</div>

<!-- All items deleted -->
<div class="col-sm-12">
	<div
		th:if="${failedDeletions != null and #lists.isEmpty(failedDeletions)}"
		class="alert alert-success alert-dismissible text-center" role="alert">
		<button type="button" class="close" data-dismiss="alert">
			<span aria-hidden="true">&times;</span> <span class="sr-only">Close</span>
		</button>
		<span th:if="${fileDeleted != null}"
			th:text="|The file ${fileDeleted} was successfully deleted.|"></span>
		<span th:unless="${fileDeleted != null}">The selected files
			were successfully deleted.</span>
	</div>
</div>

<!-- Some items were not deleted -->
<div class="col-sm-12">
	<div th:if="${not #lists.isEmpty(failedDeletions)}"
		class="alert alert-danger alert-dismissible text-center" role="alert">
		<button type="button" class="close" data-dismiss="alert">
			<span aria-hidden="true">&times;</span> <span class="sr-only">Close</span>
		</button>
		<span>The following items failed to be deleted: </span> <b
			th:text="${#strings.replace(#strings.replace(#strings.toString(failedDeletions), '[', ''), ']', '')}"></b>
	</div>
</div>

<!-- Bread Crumb -->
<div id="directoryPath" class="col-xs-12" th:include="${'collections/collectionsBreadCrumb'}">		
</div>

<div class="col-xs-12" th:if="${permissionType != 'none' or user.isAdmin()}">

	<!-- Apply templates activity indicator -->
	<div id="actionApplyTemplates" class="col-xs-12 hideElement">
		<div id="panelApplyTemplates">
			<div style="float: left">
				<span style="text-align: right">Applying templates...</span>
			</div>
			<div class="progress">
				<div class="progress-bar progress-bar-striped active"
					role="progressbar" aria-valuenow="100" aria-valuemin="0"
					aria-valuemax="100" style="width: 100%"></div>
			</div>
		</div>
	</div>

	<!-- Download activity indicator -->
	<div id="actionDownload" class="col-xs-12 hideElement">
		<div id="panelDownload">
			<div style="float: left">
				<span style="text-align: right">Preparing files for
					download...</span>
			</div>
			<div class="progress">
				<div class="progress-bar progress-bar-striped active"
					role="progressbar" aria-valuenow="100" aria-valuemin="0"
					aria-valuemax="100" style="width: 100%"></div>
			</div>
		</div>
	</div>

	<div class="panel">
		<div class="row browse-collection-files-content panel-body">
		
			<div id="table-loader" class="table-loader col-sm-12 hideElement">
				<img class="center-block" th:src="@{/images/ajax_loader.gif}" />
				<p class="text-center" th:text="#{loading.table.label}"></p>
			</div>
			<div class="" th:unless="${collectionAndDataObject == null}">
				<!-- name -->
				<div class="col-md-4 col-sm-3 collLesserInfo">
			  		<i th:if="${collectionAndDataObject.isCollection()}" class="fa fa-folder folder-icon"></i>
			        <i th:unless="${collectionAndDataObject.isCollection()}" th:class="${ collectionAndDataObject.getIconToDisplay()}"></i> 
					<span><b th:text="${ collectionAndDataObject.getName() }"></b></span>
					<span class="resulting-permission" th:text="${ '[' + collectionAndDataObject.getMostPermissiveAccessForCurrentUser() + ' access]'}"></span>
				</div>
				
				<div class="col-md-8 col-sm-9 collLesserInfo">
					<ul class="pull-right">
						<li>
							<label th:text="#{collections.management.table.owner.label}"></label>: 
							<span th:text="${ collectionAndDataObject.getOwner() }"></span>
						</li>
						<li>
							<label th:text="#{collections.management.table.created.label}"></label>: 
							<span th:text="${ collectionAndDataObject.getCreatedAtFormatted() }"></span>
						</li>
						<li>
							<label th:text="#{collections.management.table.modified.label}"></label>: 
							<span th:text="${ collectionAndDataObject.getModifiedAtFormatted() }"></span>
						</li>
					</ul>
				</div>
				<div class="col-md-12 col-sm-12"><div class="col-md-12 col-sm-12 collLesserInfo divider"></div></div>
			</div>
			<div id="actionsWait" class="hideElement col-xs-6">
               	Retrieving permissions from Data grid...
               </div>
           
			<div id="actions" class="col-xs-6">
				<div class="btn-group">
					<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" disabled="">
				    	<span>Select Action</span> &nbsp;
				  		<span class="caret"></span>
				    	<span class="sr-only">Toggle Dropdown</span>
				  	</button>
				  	<ul class="dropdown-menu" role="menu">
				  		<li>
							<a href="#" id="moveBtn" class="hideElement" data-toggle="modal" data-target="#moveModal">
								<span><i class="fa fa-exchange"></i> </span>
								<span>Move</span>
							</a>
						</li>
						<li>
							<a href="#" id="copyBtn" class="hideElement" data-toggle="modal" data-target="#copyModal">
								<span><i class="fa fa-files-o"></i></span> 
								<span>Copy</span>
							</a>
						</li>
						<li>
							<a href="#" id="replicateBtn" class="hideElement" data-toggle="modal" data-target="#replicateModal">
								<span><i class="fa fa-clone"></i></span> 
								Replicate
							</a>
						</li>
						<li>
							<a href="#" id="modifyBtn" class="hideElement" onclick="showModifyForm();">
								<span><i class="fa fa-pencil-square-o"> </i></span> 
								<span>Edit</span>
							</a>
						</li>
						<li>
							<a href="#" id="applyTemplatesBtn" class="hideElement" onclick="listAllTemplates();">
								<span><i class="fa fa-th"></i></span> 
								<span>Apply Template</span>
							</a>
						</li>
						<li class="divider"></li>
				  		<li>
					  		<a id="downloadBtn" href="/emc-metalnx-web/fileOperation/prepareFilesForDownload/" class="hideElement">
								<span><i class="fa fa-cloud-download"></i></span> 
								<span>Download</span> 
							</a>
						</li>
						<li class="divider"></li>
						<li>
							<a href="#" id="deleteBtn" class="hideElement" data-toggle="modal" data-target="#deleteModal">
								<span><i class="fa fa-trash-o"></i> </span> 
								<span>Delete</span>
							</a>
						</li>
					</ul>							
				</div>
			</div>
          
			<div class="col-xs-6">
                   <a href="#" th:if="${isTrash}" id="emptyTrashBtn" th:title="#{collections.empty.trash.button.tooltip}" class="pull-right hideElement" data-toggle="modal" data-target="#emptyTrashModal">
                       <span class="glyphicon glyphicon-trash"></span>
                       <span th:text="#{empty.trash.label}"></span> 
                   </a>
				<div th:if="${permissionType != 'none' and permissionType != 'read' and #bools.isFalse(isTrash)}" id="actionUpload" class="pull-right">
					<a role="button" href="#" class="btn btn-primary pull-right" data-toggle="modal"
						data-target="#addAndModifyModal" id="showCollectionFormBtn"
						style="margin-left: 10px" th:title="#{collections.management.add.button}">
						<span class="fa-stack fa-lg">
			              <i class="fa fa-folder fa-stack-2x"></i>
			              <i class="fa fa-plus fa-stack-1x icon-inside"></i>
			            </span>
					</a> 
					<a role="button" href="#" class="btn btn-primary pull-right" data-toggle="modal"
						data-target="#uploadModal" id="uploadIcon" title="Upload file(s) to iRods"> <i
						class="fa fa-cloud-upload"></i>
					</a>
				</div>
				<!-- Removal activity indicator -->
				<div id="actionRemoval" class="pull-right hideElement">
					<div id="panelRemoval">
						<div class="pull-left">
							<span>Removing files...</span>
						</div>
						<div class="progress">
							<div class="progress-bar progress-bar-striped active"
								role="progressbar" aria-valuenow="100" aria-valuemin="0"
								aria-valuemax="100" style="width: 100%"></div>
						</div>
					</div>
				</div>
			</div>
               
               <div class="col-xs-12">
   				<table class="table table-hover" id="treeViewTable">
   					<thead>
   						<tr>
   							<th class="tableCheckBoxCol"><input type="checkbox" name="selectAllCheckboxes" value="1" th:disabled="${currentPath == '/'}"/></th>
   							<th th:text="#{collections.management.table.collection.name.label}"></th>
   							<th th:text="#{collections.management.table.owner.label}"></th>
   							<th th:text="#{collections.management.table.kind.label}"></th>
   							<th th:text="#{collections.management.table.modified.label}"></th>
   							<th th:text="#{collections.management.table.size.label}"></th>
   						</tr>
   					</thead>
   				</table>
               </div>
		</div>
	</div>
</div>

<!-- Some items were not deleted -->
<div class="col-xs-12" th:unless="${permissionType != 'none' or user.isAdmin()}">
    <div class="text-center" role="alert">
        <span>You do not have permissions to access information in the target collection or for the selected object.</span>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <a href="#" onclick="javascript:goBackHistory('1');">
            <span>Back</span>
        </a>
    </div>
</div>

<!-- Empty Trash Modal -->
<div class="modal fade" id="emptyTrashModal" tabindex="-1" role="dialog"
	 aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">
					<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
				</button>
				<h4 class="modal-title" th:text="${'Empty Trash'}"></h4>
			</div>
			<div class="modal-body">
				<span th:utext="#{trash.deletion.confirmation(${trashColl})}"></span>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal"
						th:text="#{confirmation.message.no}"></button>
				<button id= "emptyTrashConfBtn" onclick="emptyTrash();" type="button" class="btn btn-primary"
						data-dismiss="modal" th:text="#{confirmation.message.yes}"></button>
			</div>
		</div>
	</div>
</div>

<script th:inline="javascript">
/*<![CDATA[*/
		var path;
		var url;
		
		var permission = null;
        var groupsToHavePermissionsGranted = null;
        var usersToHavePermissionsGranted = null;
        var path = null;
        var currentPermissionTab = "groups";
        var datatable;
       
      
        
        $(document).ready(function(e){  
        	
			// Add tooltip on Upload button
	        $('#uploadIcon').tooltip({
	    		content:[[#{collections.upload.button.tooltip}]],
	   			trigger: 'hover',
	       		placement: 'bottom',
	   		});
	        // Add tooltip on Add Collection
	        $('#showCollectionFormBtn').tooltip({
	    		content:[[#{collections.management.add.button.tooltip}]],
	   			trigger: 'hover',
	       		placement: 'bottom',
	   		});
	        // Add tooltip on Empty Trash button
	        $('#emptyTrashBtn').tooltip({
	        	content:[[#{collections.empty.trash.button.tooltip}]],
	   			trigger: 'hover',
	       		placement: 'bottom',
	        });
        	
        	if(![[${isCurrentPathCollection}]]){
        		getInfoDetails([[${currentPath}]]);
        		return;
        	}
        	datatable = $('#treeViewTable').DataTable( {
    		    "serverSide": true,
    		    "dom": dtPatternMlxStandard,
    		    "language": i18n,
    		    "ordering": false,
    		    "destroy": true,
    		    "stateSave": true,
    		    "autoWidth": false,
    		    "stateSaveParams": function (settings, data) {
    		    	data.search.search = "";
    		    },
    		    "ajax": {
    		        url: '/emc-metalnx-web/collections/getPaginatedJSONObjs/',
    		    },
    	        "initComplete": function(settings){
    	            $('#treeViewTable tbody td').each(function () {
    	               $(this).attr('title', $(this).text().trim());
    	            });
    	            
    	            if(datatable.data().length == 0) {
    	            	$("#emptyTrashBtn").addClass("hideElement");
    	            }
    	            else {
    	            	$("#emptyTrashBtn").removeClass("hideElement");            	
    	            }
    	        },
    	        "drawCallback": function(){
    	            $(".dataTables_paginate.paging_simple_numbers .pagination").addClass("pagination-sm");
    	            $('.dataTables_paginate.paging_simple_numbers')
    	            .css( 'display', this.api().data().length <= 0 ?
    	                 'none' :
    	                 'block'
    	            )
    	        },
  		    	"columnDefs": [
                    {
                    	"render": function ( data, type, full, meta ) {
    						return '<input type="checkbox" name="collectionPathCheckboxes" value="'+full.path+'" id="'+full.name+'" collection="'+full.collection+'"/>';
    					},
    					"className": "dt-center",
    					"width": "25px",
    					"targets": 0
                    },
                    {
                    	"render": function ( data, type, full, meta ) {
    						return '<a href="#" name="' + full.path + 
								'" onclick="'+(full.collection?'getSubDirectories(\'':'goToDataObjDetails(\'')+full.path+'\')" title="' + full.path + 
								'"><i class="'+full.iconToDisplay+'"></i>  <span>'+full.name+'</span></a>';
    					},
    					"width": "50%",
    					"targets": 1
                    },
                    {
                    	"data": "owner", 
                    	"width": "10%", 
                    	"targets": 2
                   	},
                    {
                    	"render": function ( data, type, full, meta ){
                    		return full.collection?[[#{collections.management.table.kind.collection}]]:[[#{collections.management.table.kind.dataobject}]];
                    	}, 
                    	"width": "10%",
                    	"targets": 3
                   	},
                    {
                    	"data": "modifiedAtFormatted", 
                    	"width": "15%", 
                    	"targets": 4
                   	},
                    {
                    	"render": function ( data, type, full, meta ){
                    		return full.collection? "-" : full.displaySize
                    	}, 
                    	"width": "13%",
                    	"targets": 5
                   	}
                ]
    		} );
    						
        	addGoToPage('treeViewTable', datatable);
        });
		
		$("body").on("change", "input[name=selectAllCheckboxes]", function(){
			var paths = new Array();
			
			//select all collections
			if($(this).is(":checked")){
				$("#actions").hide();
				$("#actionsWait").show();
				url = "/emc-metalnx-web/collections/addArrayToSourcePaths/";
				
				$("#treeViewTable tbody input[name=collectionPathCheckboxes]").each(function(){
					paths.push($(this).attr("value"));
					$(this).prop("checked", true);
					$(this).parent().parent().addClass("info");
				});
				
				ajaxEncapsulation(url, "POST", {paths: paths}, handleActionPermissionsWhenAddingPaths, null, null);
				
				//hiding the rename button
				$("#actions #modifyBtn").hide();

			}
			//unselect all collections
			else {
				url = "/emc-metalnx-web/collections/removeArrayFromSourcePaths/";
				
				$("#treeViewTable tbody input[name=collectionPathCheckboxes]").each(function(){
					paths.push($(this).attr("value"));
					$(this).prop("checked", false);
					$(this).parent().parent().removeClass("info");
				});	
				
				ajaxEncapsulation(
						url, 
						"POST", 
						{paths: paths}, 
						function() { $("#actions button").prop("disabled", true); }, 
						null, 
						null);
				
				$("#actions button").prop("disabled", true);
			}
		});
		
		
		$("body").on('change', '#treeViewTable tbody input[type=checkbox]', function(){
			if($("#treeViewTable tbody input[type=checkbox]:checked").length == $("#treeViewTable tbody input[type=checkbox]").length){
				$("input[name=selectAllCheckboxes]").prop("checked", true);
			}
			else {
				$("input[name=selectAllCheckboxes]").prop("checked", false);
			}			
			path = $(this).attr("value");
			
			if($(this).is(":checked")){
				$(this).parent().parent().addClass("info");
				$("#actions a").show();
				url = "/emc-metalnx-web/collections/addToSourcePaths/";
				var totalCheckboxesChecked = $("#treeViewTable tbody input[type=checkbox]:checked").length;
				
				if($("#treeViewTable tbody input[type=checkbox]:checked").length > 1) {
					$("#actions #modifyBtn").hide(); 
				}
				
				if($(this).attr('collection') == 'true'){
				    $('#replicateBtn').hide();
				}
				ajaxEncapsulation(url, "POST", {path: path}, handleActionPermissionsWhenAddingPaths, null, null);
			}
			else {	
				$(this).parent().parent().removeClass("info");
				url = "/emc-metalnx-web/collections/removeFromSourcePaths/";
				var totalCheckboxesChecked = $("#treeViewTable tbody input[type=checkbox]:checked").length;
				if(totalCheckboxesChecked == 1) {
					$("#actions a").show();	
					$("#actions button").prop("disabled", false);
				}
				else if (totalCheckboxesChecked > 1){
					$("#actions a").show();	
					$("#actions #modifyBtn").hide();					
				}
				else {
					$("#actions a").hide();
					$("#actions button").prop("disabled", true);
				}
				ajaxEncapsulation(url, "POST", {path: path}, handleActionPermissionsWhenRemovingPaths, null, null);
			}
			
			if($('#treeViewTable tbody input[collection="true"]:checked').length == 0){
			    $('#replicateBtn').show();
			}
		});
		
		function handleActionPermissionsWhenAddingPaths(permissionType) {
			$("#actionsWait").hide();
			$("#actions").show();
			if(0 >= $("#treeViewTable tbody input[type=checkbox]:checked").length){
				$("#actions button").prop("disabled", true);
			}
			else {
				$("#actions ul.dropdown-menu li").removeClass("hideElement")
				switch(permissionType.toLowerCase()) {
					case "none":
						if(!$("#actions button").is(":disabled")) {
							$("#actions button").prop("disabled", true);
						}					
						break;
					case "admin":
						$("#actions button").prop("disabled", false);
						$("#applyTemplatesBtn").parent("li").addClass("hideElement");
						$("#moveBtn").parent("li").addClass("hideElement");
						$("#copyBtn").parent("li").addClass("hideElement");
						$("#modifyBtn").parent("li").addClass("hideElement");
						$("#downloadBtn").parent("li").addClass("hideElement");
						$("#deleteBtn").parent("li").addClass("hideElement");
						break;
					case "read":
						$("#actions button").prop("disabled", false);
						$("#applyTemplatesBtn").parent("li").addClass("hideElement");	
						$("#moveBtn").parent("li").addClass("hideElement");
						$("#modifyBtn").parent("li").addClass("hideElement");
						$("#deleteBtn").parent("li").addClass("hideElement");				
						break;
					case "write":
						//write permissions let users download, copy, replicate and apply templates
						$("#actions button").prop("disabled", false);
						$("#moveBtn").parent("li").addClass("hideElement");
						$("#modifyBtn").parent("li").addClass("hideElement");
						$("#deleteBtn").parent("li").addClass("hideElement");
						break;
					case "own":
						$("#actions button").prop("disabled", false);
						break;
				}
			}
		}
		
		function handleActionPermissionsWhenRemovingPaths(mostRestrictivePermission) {
			$("#actionsWait").hide();
			$("#actions").show();
			
			if(0 >= $("#treeViewTable tbody input[type=checkbox]:checked").length){
				$("#actions button").prop("disabled", true);
			}
			else {
				switch(mostRestrictivePermission.toLowerCase()) {
					case "none":
						$("#actions button").prop("disabled", true);
						break;
					case "read": //read permissions let users download, copy, replicate 
						$("#actions button").prop("disabled", false);
						$("#applyTemplatesBtn").parent("li").addClass("hideElement");	
						$("#moveBtn").parent("li").addClass("hideElement");
						$("#modifyBtn").parent("li").addClass("hideElement");
						$("#deleteBtn").parent("li").addClass("hideElement");				
						break;
					case "write": //write permissions let users download, copy, replicate and apply templates	
						$("#actions button").prop("disabled", false);
						$("#actions li").removeClass("hideElement");
						$("#moveBtn").parent("li").addClass("hideElement");
						$("#modifyBtn").parent("li").addClass("hideElement");
						$("#deleteBtn").parent("li").addClass("hideElement");
						break;
					case "own":
						$("#actions button").prop("disabled", false);
						$("#actions li").removeClass("hideElement");
						break;
				}
			}
		}
        $("#showCollectionFormBtn").click(function () {
        	var url = [[ ${ urlMap.URL_ADD_COLLECTION_USER } ]];
        	ajaxEncapsulation(url, "GET", "", displayAddModifyCollectionModal, null, null);
		});
        
        $("#downloadBtn").click(function(e) {
        	e.preventDefault();
        	$("#actionUpload").hide();
        	$("#actionDownload").show();
        	var downloadURL = $("#downloadBtn").attr("href");
        	ajaxEncapsulation(downloadURL, "GET", null, handleDownload, handleDownloadFailure, null, null);
			$("#actions button").prop("disabled", true);
        });
        
        function handleDownload() {
        	$("#actionDownload").hide();
        	$("#actionUpload").show();
        	$("#treeViewTable tbody input[name=collectionPathCheckboxes]").prop("checked", false);
        	$("#treeViewTable input[name=selectAllCheckboxes]").prop("checked", false);
        	$("#treeViewTable tbody input[name=collectionPathCheckboxes]").parent().parent().removeClass("info");
        	window.location.href = "/emc-metalnx-web/fileOperation/download/";
        }
        
		function handleDownloadFailure() {
        	$("#actionDownload").hide();
        	$("#downloadFailureMessage").show();
        	$("input[name=selectAllCheckboxes]").prop('checked', false);
        	$("input[name=collectionPathCheckboxes]").prop('checked', false);
        }
        
        function getPermDetails(path){
            $('#table-loader').nextAll().remove();
        	$('#table-loader').show();
        	var url = "/emc-metalnx-web/permissions/getPermissionDetails/";
        	
        	ajaxEncapsulation(url, "POST", {path: path}, displayPermDetails, null, null);
		}
        
        
        function getInfoDetails(path){
        	$("#table-loader").show();
        	$("#table-loader").nextAll().remove();
        	//$(".nav-tabs a[href='#info-collection']").tab("show");
        	
        	var url = "/emc-metalnx-web/collections/info/";
			ajaxEncapsulation(url, "POST", {path: path}, displayInfoDetails, null, null, null);
			
        	ajaxEncapsulation(
   				'/emc-metalnx-web/collections/getBreadCrumbForObject/', 
   				"POST", 
   				{path: path}, 
   				function(data){
   					$("#directoryPath").html(data);
   				}, null, null, null
   			);
        }
        
        function getMetadata(path){
        	$('#table-loader').show();
        	$('#table-loader').nextAll().remove();
        	ajaxEncapsulation("/emc-metalnx-web/metadata/getMetadata/", "POST", {path: path}, displayMetadata, null, null, null);
		}
        
        function displayMetadata(data){
			$('#table-loader').hide();
			$('#table-loader').after(data);
		}
        
        function displayPermDetails(data){
            $('#table-loader').hide();
            $("#table-loader").after(data);
        }
        
        function displayAddModifyCollectionModal(data){
			$("#addAndModifyModal .modal-form-content").html(data);
			$("#addAndModifyModal").modal("show");
        }

        $('a[data-target="#uploadModal"]').click(function(){
        	ajaxEncapsulation("/emc-metalnx-web/collections/getAvailableRescForPath/", "POST", {path: path}, displayUploadModal, null, null, null);
        });
        function displayUploadModal(data){
        	$('#selectResourceToUpload').html(data);
        }
        $('a[data-target="#replicateModal"]').click(function(){
        	ajaxEncapsulation("/emc-metalnx-web/collections/getAvailableRescForPath/", "POST", {path: path}, displayReplicateModal, null, null, null);
        });
        function displayReplicateModal(data){
        	$('#selectResourceForReplication').html(data);
        }

		function emptyTrash() {
			var url ="/emc-metalnx-web/fileOperation/emptyTrash/";
			ajaxEncapsulation(url, "POST", null, emptyTrashSuccess, emptyTrashFailure, null, null);
		}

		function emptyTrashSuccess() {
			$("#trashNotEmptiedSuccessfully").addClass("hideElement");
			$("#trashEmptiedSuccessfully").removeClass("hideElement");
			getSubDirectories([[${ trashColl }]]);
		}

		function emptyTrashFailure() {
			$("#trashEmptiedSuccessfully").addClass("hideElement");
			$("#trashNotEmptiedSuccessfully").removeClass("hideElement");
			getSubDirectories([[${ currentPath }]]);
		}

    /*]]>*/
	</script>
